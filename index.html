<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نخبة المهام | Elite Tasks</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;500;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        body {
            font-family: 'Tajawal', sans-serif;
            background: radial-gradient(circle at top right, #1e293b, #0f172a);
            color: white;
            min-height: 100vh;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }
        .input-style {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        .input-style:focus {
            border-color: #3b82f6;
            background: rgba(255, 255, 255, 0.1);
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.3);
        }
        .gradient-btn {
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
        }
        #tasks-list::-webkit-scrollbar { width: 5px; }
        #tasks-list::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 10px; }
    </style>
</head>
<body>

    <div id="loading-screen" class="fixed inset-0 z-50 flex items-center justify-center bg-slate-950">
        <div class="w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"></div>
    </div>

    <div id="auth-ui" class="hidden w-full max-w-md animate__animated animate__zoomIn">
        <div class="glass-card p-10 rounded-[2rem] text-center">
            <h1 class="text-4xl font-bold bg-gradient-to-l from-blue-400 to-purple-500 bg-clip-text text-transparent mb-8">نخبة المهام</h1>
            <div class="space-y-4">
                <input id="email" type="email" placeholder="البريد الإلكتروني" class="w-full p-4 rounded-2xl input-style outline-none text-center">
                <input id="password" type="password" placeholder="كلمة المرور" class="w-full p-4 rounded-2xl input-style outline-none text-center">
                <button onclick="handleLogin()" class="w-full p-4 rounded-2xl gradient-btn font-bold text-lg hover:scale-105 transition shadow-lg">دخول</button>
                <button onclick="handleRegister()" class="w-full p-4 rounded-2xl border border-white/10 hover:bg-white/5 transition text-sm text-gray-400">إنشاء حساب جديد</button>
                <div class="relative py-2 text-gray-500 text-xs uppercase">أو</div>
                <button onclick="handleGoogleLogin()" class="w-full p-4 rounded-2xl bg-white text-slate-900 font-bold flex items-center justify-center gap-3 hover:bg-gray-200 transition">
                    <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="20"> Google
                </button>
            </div>
        </div>
    </div>

    <div id="app-ui" class="hidden w-full max-w-2xl animate__animated animate__fadeIn p-4">
        <div class="glass-card p-8 rounded-[2.5rem]">
            <div class="flex justify-between items-center mb-8">
                <h2 id="user-welcome" class="text-2xl font-bold">مهامي ✨</h2>
                <button onclick="logout()" class="p-3 text-red-400 hover:bg-red-500/10 rounded-xl transition cursor-pointer">
                    <i data-lucide="log-out"></i>
                </button>
            </div>

            <div class="relative mb-8">
                <input id="task-input" type="text" placeholder="ما هي خطتك القادمة؟" class="w-full p-5 pr-14 rounded-2xl input-style outline-none text-lg">
                <button onclick="addTask()" class="absolute left-3 top-2 bottom-2 px-6 rounded-xl gradient-btn font-bold hover:brightness-110 transition">إضافة</button>
            </div>

            <ul id="tasks-list" class="space-y-4 max-h-[450px] overflow-y-auto pr-2">
                </ul>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <script>
        // 1. الإعدادات الخاصة بك
        const firebaseConfig = {
            apiKey: "AIzaSyDR7vrvcr6lWNyamJiSJeApkiLNpyTmgwY",
            authDomain: "task-889c3.firebaseapp.com",
            projectId: "task-889c3",
            storageBucket: "task-889c3.firebasestorage.app",
            messagingSenderId: "472967555818",
            appId: "1:472967555818:web:9c1298bfbe9c1b006e8593"
        };

        // تهيئة فايربيس
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // 2. مراقبة حالة المستخدم
        auth.onAuthStateChanged(user => {
            document.getElementById('loading-screen').classList.add('hidden');
            if (user) {
                document.getElementById('auth-ui').classList.add('hidden');
                document.getElementById('app-ui').classList.remove('hidden');
                document.getElementById('user-welcome').innerText = `أهلاً، ${user.displayName || 'بك'} ✨`;
                loadTasks(user.uid);
            } else {
                document.getElementById('app-ui').classList.add('hidden');
                document.getElementById('auth-ui').classList.remove('hidden');
            }
        });

        // 3. وظائف الدخول
        async function handleGoogleLogin() {
            try { await auth.signInWithPopup(new firebase.auth.GoogleAuthProvider()); } 
            catch(e) { alert(e.message); }
        }

        async function handleLogin() {
            const email = document.getElementById('email').value.trim();
            const pass = document.getElementById('password').value;
            if(!email || !pass) return alert("امسح الحقول الفارغة");
            try { await auth.signInWithEmailAndPassword(email, pass); } 
            catch(e) { alert("خطأ في البيانات: " + e.message); }
        }

        async function handleRegister() {
            const email = document.getElementById('email').value.trim();
            const pass = document.getElementById('password').value;
            try { 
                await auth.createUserWithEmailAndPassword(email, pass); 
                alert("تم إنشاء الحساب بنجاح!");
            } catch(e) { alert(e.message); }
        }

        function logout() {
            auth.signOut().then(() => console.log("تم تسجيل الخروج"));
        }

        // 4. إدارة المهام
        async function addTask() {
            const input = document.getElementById('task-input');
            const user = auth.currentUser;
            if (!input.value.trim() || !user) return;

            try {
                await db.collection("tasks").add({
                    userId: user.uid,
                    text: input.value.trim(),
                    done: false,
                    time: firebase.firestore.FieldValue.serverTimestamp()
                });
                input.value = "";
            } catch (error) {
                alert("فشل الإضافة: " + error.message);
            }
        }

        function loadTasks(uid) {
            db.collection("tasks")
              .where("userId", "==", uid)
              .onSnapshot(snap => {
                const list = document.getElementById('tasks-list');
                list.innerHTML = "";
                
                if (snap.empty) {
                    list.innerHTML = `<li class="text-center text-gray-500 py-10">لا توجد مهام حالياً</li>`;
                }

                snap.forEach(doc => {
                    const task = doc.data();
                    const li = document.createElement('li');
                    li.className = `glass-card p-4 rounded-2xl flex justify-between items-center animate__animated animate__fadeInRight ${task.done ? 'opacity-50' : ''}`;
                    li.innerHTML = `
                        <div class="flex items-center gap-3">
                            <button onclick="toggle('${doc.id}', ${task.done})" class="w-7 h-7 rounded-full border-2 border-blue-500 flex items-center justify-center transition ${task.done ? 'bg-blue-500' : ''}">
                                ${task.done ? '✓' : ''}
                            </button>
                            <span class="text-lg ${task.done ? 'line-through text-gray-400' : ''}">${task.text}</span>
                        </div>
                        <button onclick="del('${doc.id}')" class="p-2 text-gray-500 hover:text-red-500 transition cursor-pointer">
                            <i data-lucide="trash-2" class="pointer-events-none"></i>
                        </button>
                    `;
                    list.appendChild(li);
                });
                lucide.createIcons();
            });
        }

        async function toggle(id, currentStatus) {
            await db.collection("tasks").doc(id).update({ done: !currentStatus });
        }

        async function del(id) {
            if (confirm("هل تريد حذف هذه المهمة؟")) {
                await db.collection("tasks").doc(id).delete();
            }
        }

        // تفعيل الأيقونات لأول مرة
        lucide.createIcons();
    </script>
</body>
</html>
